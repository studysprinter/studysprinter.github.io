<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Science Olympiad Prep</title>
  <style>
    body { font-family: Arial, sans-serif; background: #121212; color: #e0e0e0; margin: 0; display: flex; height: 100vh; }
    .sidebar { background: #1e1e1e; padding: 20px; width: 280px; display: flex; flex-direction: column; }
    .sidebar button, select { margin-bottom: 15px; padding: 10px; border: none; border-radius: 5px; font-size: 1rem; cursor: pointer; }
    .sidebar button { background: #4caf50; color: black; font-weight: bold; }
    .sidebar button:hover { background: #43a047; }
    .main { flex-grow: 1; padding: 30px; overflow-y: auto; }
    h1 { color: #4caf50; }
    label { display: block; margin: 8px 0 4px; }
    form button { margin-top: 10px; }
    #feedback { margin-top: 15px; font-weight: bold; }
  </style>
</head>
<body>
  <div class="sidebar">
    <h2>Choose Division</h2>
    <button onclick="selectDivision('B')">Science Olympiad Division B</button>
    <button onclick="selectDivision('C')">Science Olympiad Division C</button>
    <button onclick="goBack()">⬅ Back</button>

    <div id="eventsSection" style="display:none;">
      <label for="eventSelect">Choose Event</label>
      <select id="eventSelect" onchange="updateSkills()"></select>

      <label for="skillSelect">Choose Skill</label>
      <select id="skillSelect"></select>

      <label for="yearSelect">Choose Year</label>
      <select id="yearSelect">
        <option>2025</option>
        <option>2024</option>
        <option>2023</option>
        <option>2022</option>
        <option>2021</option>
      </select>

      <button onclick="nextQuestion()">Next Question</button>
    </div>
  </div>

  <div class="main" id="mainContent">
    <h1>Welcome to Science Olympiad Prep</h1>
    <p>Select a division to begin answering questions.</p>
  </div>

  <script>
    const events = {
      B: ['Entomology', 'Disease Detectives', 'Anatomy and Physiology'],
      C: []
    };

    const skills = {
      'Entomology': ['Identification', 'Multiple Choice', 'Everything Else'],
      'Disease Detectives': ['Math', 'Vocab', 'Full Case Studies', 'Everything Else'],
      'Anatomy and Physiology': ['Diagrams', 'Multiple Choice', 'Everything Else']
    };

    let currentDivision = null;

    function selectDivision(div) {
      currentDivision = div;
      const eventSelect = document.getElementById('eventSelect');
      eventSelect.innerHTML = '';
      events[div].forEach(ev => {
        const opt = document.createElement('option');
        opt.value = ev;
        opt.textContent = ev;
        eventSelect.appendChild(opt);
      });
      updateSkills();
      document.getElementById('eventsSection').style.display = 'block';
      document.getElementById('mainContent').innerHTML = `<h1>Division ${div} - Question Page</h1><p>Select an event, skill, and year on the left, then click Next Question.</p>`;
    }

    function updateSkills() {
      const event = document.getElementById('eventSelect').value;
      const skillSelect = document.getElementById('skillSelect');
      skillSelect.innerHTML = '';
      (skills[event] || []).forEach(skill => {
        const opt = document.createElement('option');
        opt.value = skill;
        opt.textContent = skill;
        skillSelect.appendChild(opt);
      });
    }

    async function nextQuestion() {
      const event = document.getElementById('eventSelect').value;
      const skill = document.getElementById('skillSelect').value;
      const year = document.getElementById('yearSelect').value;

      const main = document.getElementById('mainContent');
      main.innerHTML = `<p>Loading question...</p>`;

      try {
        const res = await fetch('http://localhost:5000/generate-question', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ event, skill, year })
        });

        if (!res.ok) throw new Error('Network response was not ok');

        const q = await res.json();

        let formHTML = '';
        if (q.type === 'MC' && Array.isArray(q.choices)) {
          formHTML += `<form id="answerForm">`;
          q.choices.forEach((choice, i) => {
            formHTML += `<label><input type="radio" name="userAnswer" value="${choice}" required> ${choice}</label>`;
          });
          formHTML += `<button type="submit">Submit</button></form>`;
        } else {
          formHTML = `
            <form id="answerForm">
              <input type="text" id="userAnswer" placeholder="Type your answer here..." required />
              <button type="submit">Submit</button>
            </form>
          `;
        }

        main.innerHTML = `
          <h1>${q.event} - ${q.skill} (${q.year})</h1>
          <p>${q.question}</p>
          ${formHTML}
          <div id="feedback"></div>
        `;

        document.getElementById('answerForm').addEventListener('submit', function(e) {
          e.preventDefault();
          checkAnswer(q.answer);
        });

      } catch (error) {
        main.innerHTML = `<p>Error loading question: ${error.message}</p>`;
      }
    }

    function checkAnswer(correctAnswer) {
      const inputs = document.querySelectorAll('input[name="userAnswer"]');
      let userAnswer = '';
      if (inputs.length > 0 && inputs[0].type === 'radio') {
        inputs.forEach(i => { if(i.checked) userAnswer = i.value; });
      } else {
        const inputField = document.getElementById('userAnswer');
        userAnswer = inputField ? inputField.value.trim() : '';
      }

      const feedback = document.getElementById('feedback');
      if (userAnswer.toLowerCase() === correctAnswer.toLowerCase()) {
        feedback.innerHTML = '<span style="color: #4caf50;">✅ Correct!</span>';
      } else {
        feedback.innerHTML = `<span style="color: #f44336;">❌ Incorrect.</span> Correct answer: <strong>${correctAnswer}</strong>`;
      }
    }

    function goBack() {
      document.getElementById('eventsSection').style.display = 'none';
      document.getElementById('mainContent').innerHTML = `
        <h1>Welcome to Science Olympiad Prep</h1>
        <p>Select a division to begin answering questions.</p>`;
    }
  </script>
</body>
</html>












