<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Science Olympiad Prep</title>
  <style>
    body {font-family: Arial, sans-serif; background: #121212; color: #e0e0e0; margin:0; display:flex; height:100vh;}
    .sidebar {background: #1e1e1e; padding:20px; width:280px; display:flex; flex-direction:column;}
    .sidebar button, select {margin-bottom:15px; padding:10px; border:none; border-radius:5px; font-size:1rem; cursor:pointer; background-color:#4caf50; color:black; font-weight:bold; user-select:none;}
    .sidebar button:hover, select:hover {background-color:#43a047;}
    .sidebar label {margin-bottom:6px; font-weight:600; user-select:none;}
    .main {flex-grow:1; padding:30px; overflow-y:auto;}
    h1 {color:#4caf50; margin-bottom:15px;}
    form label {display:block; margin:8px 0 4px; user-select:none;}
    form button {margin-top:10px; padding:10px 15px; border:none; border-radius:5px; background-color:#4caf50; color:black; font-weight:bold; cursor:pointer; user-select:none;}
    #feedback {margin-top:15px; font-weight:bold; user-select:none;}
  </style>
</head>
<body>
  <div class="sidebar">
    <h2>Choose Division</h2>
    <button onclick="selectDivision('B')">Science Olympiad Division B</button>
    <button onclick="selectDivision('C')">Science Olympiad Division C</button>
    <button onclick="goBack()">⬅ Back</button>

    <div id="eventsSection" style="display:none;">
      <label for="eventSelect">Choose Event</label>
      <select id="eventSelect" onchange="updateSkills()"></select>

      <label for="skillSelect">Choose Skill</label>
      <select id="skillSelect" onchange="skillChanged()"></select>

      <label for="yearSelect">Choose Year</label>
      <select id="yearSelect">
        <option>2025-2026</option>
        <option>2024-2025</option>
        <option>2023-2024</option>
        <option>2022-2023</option>
        <option>2021-2022</option>
      </select>

      <button onclick="nextQuestion()">Next Question</button>
    </div>
  </div>

  <div class="main" id="mainContent">
    <h1>Welcome to Science Olympiad Prep</h1>
    <p>Select a division to begin answering questions.</p>
  </div>

  <script>
    const events = {
      B: ['Entomology', 'Disease Detectives', 'Anatomy and Physiology'],
      C: []
    };
    const skills = {
      'Entomology': ['Identification','Multiple Choice','Everything Else'],
      'Disease Detectives': ['Math','Vocab','Full Case Studies','Multiple Choice','Everything Else'],
      'Anatomy and Physiology': ['Diagrams','Multiple Choice','Everything Else']
    };
    let allQuestions = [];
    let questionsLoaded = false;
    let currentDivision = null;
    let currentDifficulty = 1;
    const maxDifficulty = 3;
    let lastQuestion = null;

    // Preload questions.json once
    window.onload = async () => {
      try {
        const res = await fetch('./questions.json');
        allQuestions = await res.json();
        questionsLoaded = true;
      } catch (e) {
        console.error('Failed to load questions.json', e);
        document.getElementById('mainContent').innerHTML = '<p style="color:red">Error loading questions. Ensure questions.json is deployed alongside index.html.</p>';
      }
    };

    function selectDivision(div) {
      currentDivision = div;
      const eventSelect = document.getElementById('eventSelect');
      eventSelect.innerHTML = '';
      events[div].forEach(ev => {
        const opt = document.createElement('option'); opt.value = ev; opt.textContent = ev; eventSelect.appendChild(opt);
      });
      updateSkills();
      document.getElementById('eventsSection').style.display = 'block';
      document.getElementById('mainContent').innerHTML = `<h1>Division ${div} - Question Page</h1><p>Select an event, skill (must be Multiple Choice), and year on the left, then click Next Question.</p>`;
      currentDifficulty = 1;
    }

    function updateSkills() {
      const event = document.getElementById('eventSelect').value;
      const skillSelect = document.getElementById('skillSelect');
      skillSelect.innerHTML = '';
      (skills[event]||[]).forEach(skill => {
        const opt = document.createElement('option'); opt.value = skill; opt.textContent = skill; skillSelect.appendChild(opt);
      });
      skillChanged();
    }

    function skillChanged() {
      const skill = document.getElementById('skillSelect').value;
      if(skill==='Multiple Choice') {
        document.getElementById('mainContent').innerHTML = '<h1>Ready for Multiple Choice Questions</h1><p>Click Next Question to start.</p>';
      } else {
        document.getElementById('mainContent').innerHTML = '<h1>No questions available</h1><p>Please select \"Multiple Choice\" skill to get questions.</p>';
      }
    }

    function filterQuestions(event, skill, difficulty) {
      return allQuestions.filter(q => q.event===event && q.skill===skill && q.difficulty===difficulty);
    }

    function nextQuestion() {
      if(!questionsLoaded) { alert('Questions are still loading—please wait a moment.'); return; }
      const event = document.getElementById('eventSelect').value;
      const skill = document.getElementById('skillSelect').value;
      if(skill!=='Multiple Choice') { alert("Please select 'Multiple Choice' skill to get questions."); return; }
      let candidates = filterQuestions(event, skill, currentDifficulty);
      if(candidates.length===0) {
        for(let d=currentDifficulty-1; d>=1; d--) {
          candidates = filterQuestions(event, skill, d);
          if(candidates.length>0) { currentDifficulty=d; break; }
        }
        if(candidates.length===0) { document.getElementById('mainContent').innerHTML='<h1>No questions found.</h1>'; return; }
      }
      let q;
      do { q=candidates[Math.floor(Math.random()*candidates.length)]; }
      while(q===lastQuestion && candidates.length>1);
      lastQuestion=q;

      let html=`<form id="answerForm">`;
      q.choices.forEach(choice=>{ html+=`<label><input type="radio" name="userAnswer" value="${choice}" required> ${choice}</label>`; });
      html+=`<button type="submit">Submit</button></form><div id="feedback"></div>`;
      document.getElementById('mainContent').innerHTML=
        `<h1>${q.event} - ${q.skill} (Difficulty: ${q.difficulty})</h1><p>${q.question}</p>${html}`;
      document.getElementById('answerForm').addEventListener('submit',e=>{
        e.preventDefault(); const selected=document.querySelector('input[name="userAnswer"]:checked').value;
        const fb=document.getElementById('feedback');
        if(selected.toLowerCase()===q.answer.toLowerCase()) {
          fb.innerHTML='<span style="color:#4caf50">✅ Correct!</span>'; if(currentDifficulty<maxDifficulty) currentDifficulty++;
        } else {
          fb.innerHTML=`<span style="color:#f44336">❌ Incorrect.</span> Correct answer: <strong>${q.answer}</strong>`;
          if(currentDifficulty>1) currentDifficulty--;
        }
      });
    }

    function goBack() {
      document.getElementById('eventsSection').style.display='none';
      document.getElementById('mainContent').innerHTML=
        `<h1>Welcome to Science Olympiad Prep</h1><p>Select a division to begin answering questions.</p>`;
    }
  </script>
</body>
</html>















